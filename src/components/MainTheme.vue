<template>
    <v-container fluid class="pa-0 fill-height">
    <!-- Á§∫‰æãÂØπËØùÊ°ÜÂç°Áâá -->
    <v-row justify="center" class="example-cards">
      <v-col cols="12" md="3" v-for="(example, index) in examples" :key="index">
        <v-card class="mx-auto" max-width="500" max-height = "100" outlined shadow = "always">
          <v-card-title>{{ example.title }}</v-card-title>
          
          <v-card-text class="d-flex justify-space-between align-center">
            <span>{{ example.description }}</span>
            <v-btn icon small @click="upload(example)">
              <v-icon size="20">mdi-upload</v-icon>
            </v-btn>
          </v-card-text>
            
        </v-card>
      </v-col>
    </v-row>
      <!-- ËøôÈáåÊîæÁΩÆ‰Ω†ÁöÑÂÖ∂‰ªñÂÜÖÂÆπ -->
      <v-dialog v-model="dialog" max-width="800px">
        <v-card>
          <v-card-title>
            <span class="headline">‰∏ä‰º†{{ currentExample.title }}</span>
          </v-card-title>

          <v-card-text>
            <!-- ÊñáÊú¨ËØÅÊçÆË°®Âçï -->
            <v-container v-if="currentExample.title === 'ÊñáÊú¨ËØÅÊçÆ üìñ'">
              <v-row>
                <v-col cols="12">
                  <v-text-field v-model="caseData.Ê°à‰ª∂Á±ªÂûã" label="Ê°à‰ª∂Á±ªÂûã" outlined></v-text-field>
                </v-col>
                <v-col cols="12">
                  <v-textarea v-model="caseData.Âü∫Êú¨Ê°àÊÉÖ" label="Âü∫Êú¨Ê°àÊÉÖ" outlined auto-grow></v-textarea>
                </v-col>
                
                <!-- ÂéüÂëä‰ø°ÊÅØ -->
                <v-col cols="12">
                  <v-expansion-panels>
                    <v-expansion-panel>
                      <v-expansion-panel-header>ÂéüÂëä‰ø°ÊÅØ</v-expansion-panel-header>
                      <v-expansion-panel-content>
                        <v-row>
                          <v-col cols="12">
                            <v-combobox
                              v-model="caseData.ÂéüÂëä.‰∫ãÂÆûËØÅÊçÆ"
                              label="‰∫ãÂÆûËØÅÊçÆ"
                              multiple
                              chips
                              outlined
                            ></v-combobox>
                          </v-col>
                          <v-col cols="12">
                            <v-combobox
                              v-model="caseData.ÂéüÂëä.‰∏™‰∫∫ÊÉÖÂÜµ"
                              label="‰∏™‰∫∫ÊÉÖÂÜµ"
                              multiple
                              chips
                              outlined
                            ></v-combobox>
                          </v-col>
                          <v-col cols="12">
                            <v-combobox
                              v-model="caseData.ÂéüÂëä.ËØâËÆºËØ∑Ê±Ç"
                              label="ËØâËÆºËØ∑Ê±Ç"
                              multiple
                              chips
                              outlined
                            ></v-combobox>
                          </v-col>
                        </v-row>
                      </v-expansion-panel-content>
                    </v-expansion-panel>
                  </v-expansion-panels>
                </v-col>

                <!-- Ë¢´Âëä‰ø°ÊÅØ -->
                <v-col cols="12">
                  <v-expansion-panels>
                    <v-expansion-panel>
                      <v-expansion-panel-header>Ë¢´Âëä‰ø°ÊÅØ</v-expansion-panel-header>
                      <v-expansion-panel-content>
                        <v-combobox
                          v-model="caseData.Ë¢´Âëä.‰∏™‰∫∫ÊÉÖÂÜµ"
                          label="‰∏™‰∫∫ÊÉÖÂÜµ"
                          multiple
                          chips
                          outlined
                        ></v-combobox>
                      </v-expansion-panel-content>
                    </v-expansion-panel>
                  </v-expansion-panels>
                </v-col>
              </v-row>
            </v-container>

            <!-- ÂõæÁâáËØÅÊçÆË°®Âçï -->
            <!-- ÂõæÁâáËØÅÊçÆË°®Âçï -->
            <v-container v-else>
              <v-row>
                <v-col cols="12">
                  <v-file-input
                    v-model="imageFiles"
                    label="ÈÄâÊã©ÂõæÁâá"
                    multiple
                    accept="image/*"
                    prepend-icon="mdi-camera"
                    outlined
                  ></v-file-input>
                </v-col>
                
                <v-col cols="12" class="d-flex flex-wrap">
                  <v-card
                    v-for="(preview, index) in imagePreviews"
                    :key="index"
                    class="ma-2 preview-card"
                    width="200"
                  >
                    <v-img
                      :src="preview.url"
                      height="200"
                      contain
                    ></v-img>
                    <v-card-text class="text-center">
                      {{ imageFiles[index].name }}
                    </v-card-text>
                    <v-btn
                      icon
                      small
                      color="red"
                      class="remove-image"
                      @click="removeImage(index)"
                    >
                      <v-icon>mdi-close</v-icon>
                    </v-btn>
                  </v-card>
                </v-col>

                <v-col cols="12">
                  <v-textarea
                    v-model="imageDescription"
                    label="ÂõæÁâáÊèèËø∞"
                    outlined
                    auto-grow
                    rows="3"
                    placeholder="ËØ∑ÊèèËø∞Ëøô‰∫õÂõæÁâá..."
                  ></v-textarea>
                </v-col>
              </v-row>
            </v-container>

          </v-card-text>

          <v-card-actions>
            <v-spacer></v-spacer>
            <v-btn color="blue darken-1" text @click="dialog = false">ÂèñÊ∂à</v-btn>
            <v-btn color="blue darken-1" text @click="submitUpload">Á°ÆËÆ§</v-btn>
          </v-card-actions>
        </v-card>
      </v-dialog>

      <!-- Â∫ïÈÉ®ÂØπËØùÊ°Ü -->
      <v-row justify="center" class="fixed-bottom mb-6">
        <v-col cols="12" sm="8" md="7">
          <v-card tile class="d-flex">
            <v-card-text class="py-1 px-2">
              <v-row>
                <v-col cols="12">
                  <v-text-field
                    label="Type your message..."
                    append-icon="mdi-send"
                    filled
                    dense
                    
                    @click:append="$router.push('/chat')"
                  ></v-text-field>
                </v-col>
              </v-row>
            </v-card-text>
          </v-card>
        </v-col>
      </v-row>
    </v-container>
  </template>
  
  
<script>
import axios from 'axios';
export default {
  data() {
    return {
      examples: [
        { title: 'ÊñáÊú¨ËØÅÊçÆ üìñ', description: 'Êú¨Ê°à‰ª∂ÁöÑÊñáÂ≠óÊÄßËØÅÊçÆ' },
        { title: 'ÂõæÁâáËØÅÊçÆ üì∑', description: 'Êú¨Ê°à‰ª∂ÁöÑÂõæÁâáËØÅÊçÆ' },
      ],
      dialog: false,
      currentExample: {},
      caseData: {
        Ê°à‰ª∂Á±ªÂûã: '',
        Âü∫Êú¨Ê°àÊÉÖ: '',
        ÂéüÂëä: {
          ‰∫ãÂÆûËØÅÊçÆ: [],
          ‰∏™‰∫∫ÊÉÖÂÜµ: [],
          ËØâËÆºËØ∑Ê±Ç: []
        },
        Ë¢´Âëä: {
          ‰∏™‰∫∫ÊÉÖÂÜµ: []
        }
      },
      imageFiles: [],
      imagePreviews: [],
      imageDescription: ''
    }
  },
  watch: {
    imageFiles(newFiles) {
      this.imagePreviews = [];

      if (!newFiles || newFiles.length === 0) return;

      newFiles.forEach(file => {
        const reader = new FileReader();
        reader.onload = (e) => {
          this.imagePreviews.push({
            url: e.target.result,
            name: file.name
          });
        };
        reader.readAsDataURL(file);
      });
    }
  },
  methods: {
    upload(example) {
      this.currentExample = example;
      this.dialog = true;
    },

    removeImage(index) {
      this.imagePreviews.splice(index, 1);
      this.imageFiles.splice(index, 1); // Áõ¥Êé•‰øÆÊîπ imageFiles Êï∞ÁªÑ
    },

    submitUpload() {
      if (this.currentExample.title === 'ÂõæÁâáËØÅÊçÆ üì∑') {
        // ÂàõÂª∫ FormData ÂØπË±°Áî®‰∫éÊñá‰ª∂‰∏ä‰º†
        const formData = new FormData();
        this.imageFiles.forEach((file) => {
          formData.append('images', file);
        });
        formData.append('description', this.imageDescription);

        // ‰ΩøÁî® axios ÂèëÈÄÅ POST ËØ∑Ê±ÇÔºåÂ∞ÜÊï∞ÊçÆÂèëÈÄÅÂà∞ÂêéÁ´Ø
        axios.post('http://localhost:5000/api/uploadImages', formData, {
          headers: {
            'Content-Type': 'multipart/form-data'
          }
        })
        .then(() => { // ÁßªÈô§‰∫Ü response ÂèÇÊï∞
          console.log('ÂõæÁâáÊï∞ÊçÆÂ∑≤ÊàêÂäüÂèëÈÄÅÂà∞ÊúçÂä°Âô®');
          // Ê†πÊçÆÈúÄË¶ÅÔºåÂèØ‰ª•Âú®ËøôÈáåÊ∑ªÂä†ÊèêÁ§∫Áî®Êà∑ÁöÑÈÄªËæë
        })
        .catch(error => {
          console.error('ÂèëÈÄÅÂõæÁâáÊï∞ÊçÆÊó∂Âá∫Èîô:', error);
          // Ê†πÊçÆÈúÄË¶ÅÔºåÂ§ÑÁêÜÈîôËØØÊÉÖÂÜµ
        });

        // ÈáçÁΩÆË°®Âçï
        this.imageFiles = [];
        this.imagePreviews = [];
        this.imageDescription = '';
      } else {
        // ÊûÑÂª∫JSONÂØπË±°
        const jsonData = {
          Ê°à‰ª∂Á±ªÂûã: this.caseData.Ê°à‰ª∂Á±ªÂûã,
          Âü∫Êú¨Ê°àÊÉÖ: this.caseData.Âü∫Êú¨Ê°àÊÉÖ,
          ÂéüÂëä: {
            ‰∫ãÂÆûËØÅÊçÆ: this.caseData.ÂéüÂëä.‰∫ãÂÆûËØÅÊçÆ,
            ‰∏™‰∫∫ÊÉÖÂÜµ: this.caseData.ÂéüÂëä.‰∏™‰∫∫ÊÉÖÂÜµ,
            ËØâËÆºËØ∑Ê±Ç: this.caseData.ÂéüÂëä.ËØâËÆºËØ∑Ê±Ç
          },
          Ë¢´Âëä: {
            ‰∏™‰∫∫ÊÉÖÂÜµ: this.caseData.Ë¢´Âëä.‰∏™‰∫∫ÊÉÖÂÜµ
          }
        };

        // ‰ΩøÁî® axios ÂèëÈÄÅ POST ËØ∑Ê±ÇÔºåÂ∞ÜÊï∞ÊçÆÂèëÈÄÅÂà∞ÂêéÁ´Ø
        axios.post('http://localhost:5000/api/saveCaseData', jsonData)
          .then(() => { // ÁßªÈô§‰∫Ü response ÂèÇÊï∞
            console.log('Ê°à‰ª∂Êï∞ÊçÆÂ∑≤ÊàêÂäüÂèëÈÄÅÂà∞ÊúçÂä°Âô®');
            // Ê†πÊçÆÈúÄË¶ÅÔºåÂèØ‰ª•Âú®ËøôÈáåÊ∑ªÂä†ÊèêÁ§∫Áî®Êà∑ÁöÑÈÄªËæë
          })
          .catch(error => {
            console.error('ÂèëÈÄÅÊ°à‰ª∂Êï∞ÊçÆÊó∂Âá∫Èîô:', error);
            // Ê†πÊçÆÈúÄË¶ÅÔºåÂ§ÑÁêÜÈîôËØØÊÉÖÂÜµ
          });

        // ÈáçÁΩÆË°®Âçï
        this.caseData = {
          Ê°à‰ª∂Á±ªÂûã: '',
          Âü∫Êú¨Ê°àÊÉÖ: '',
          ÂéüÂëä: {
            ‰∫ãÂÆûËØÅÊçÆ: [],
            ‰∏™‰∫∫ÊÉÖÂÜµ: [],
            ËØâËÆºËØ∑Ê±Ç: []
          },
          Ë¢´Âëä: {
            ‰∏™‰∫∫ÊÉÖÂÜµ: []
          }
        };
      }
      this.dialog = false;
    }
  }
}

</script>

<style scoped>
.example-cards .v-card {
  /* Ê∑ªÂä†3DÊïàÊûú */
  transform: perspective(1000px) rotateY(10deg);
  /* ËÆæÁΩÆÂúÜËßí */
  border-radius: 20px;
  /* ‰∏∫‰∫ÜÊõ¥Â•ΩÂú∞Â±ïÁ§∫3DÊïàÊûúÔºåÁªôÂç°ÁâáÊ∑ªÂä†Èò¥ÂΩ± */
  box-shadow: 5px 5px 15px rgba(0,0,0,0.3);
}
.example-cards {
  margin-top: 400px; /* ÊàñËÄÖÊ†πÊçÆ‰Ω†ÁöÑËÆæËÆ°ÈúÄÊ±ÇË∞ÉÊï¥ */
}

.preview-card {
  position: relative;
}

.remove-image {
  position: absolute;
  top: 4px;
  right: 4px;
  background: rgba(255, 255, 255, 0.8);
}

.preview-card .v-card__text {
  padding: 8px;
  font-size: 12px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
  .fixed-bottom {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
  }
  
  @media (min-width: 200px) {
    .fixed-bottom {
      left: 50%;
      transform: translateX(-50%);
    }
  }
  </style>
  